<!DOCTYPE html>
<html>
	<head>
		<title> Home
		</title>

		<style type="text/css">
		    .popover{
		        width:150%;
		        max-height: 400px;
		    }
		    iframe{
		    	border:none;
		    }

		</style>
		<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  		<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script>

	</head>
	<body>
		<img 
		src = "https://upload.wikimedia.org/wikipedia/en/2/29/McGill_University_CoA.svg"
		width  = 75px
		style="position:absolute;right:50px;top:15px;"
		/>
		<div class="container-fluid">
		<div class="page-header mymargin">
		  <h1>Relational Algebra<small>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp; McGill</small></h1>
		</div>
	</div>
		<!--导航-->
	    <nav class="navbar navbar-default">
		  <div class="container-fluid">
		    <!-- Collect the nav links, forms, and other content for toggling -->
		    <div class="collapse navbar-collapse" id="bs-example-navbar-collapse-1">
		      
		      	<div class="container">
					<div class="row">
						<div class="col-md-7">
					      	<ul class="nav navbar-nav">
						        <li style="margin-right:30px;"><a href="index.html">Relational Algebra</a></li>
						        <li style="margin-right:30px;"><a href="#">SQL</a></li>
						        <li class="dropdown">
						          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false" style="margin-right:30px;">Databases <span class="caret"></span></a>
						          <ul class="dropdown-menu">
						            <li><a href="http://localhost:3000/posts">db1</a></li>
						            <li><a href="#">db2</a></li>
						            <li><a href="#">db3</a></li>
						            <li role="separator" class="divider"></li>
						            <li><a href="#">Help</a></li>
						          </ul>
						        </li>
						        <li class="dropdown">
						          <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" aria-haspopup="true" aria-expanded="false">Create <span class="caret"></span></a>
						          <ul class="dropdown-menu">
						            <li><a href="#">create a database</a></li>
						            <li><a href="#">create a table</a></li>
						            <li><a href="#"><%= link_to 'add tuples', new_post_path %></a></li>
						          </ul>
						        </li>
					      	</ul>
		      			</div>

		      			<div class="col-md-5">
					      <form class="navbar-form navbar-right">
					        <div class="form-group">
					          <input type="text" class="form-control" placeholder="Search">
					        </div>
					        <button type="submit" class="btn btn-default">Submit</button>
					      </form> 

					        <ul class="nav navbar-nav navbar-right">
			        			<li style="margin-right:30px;"><a href="#">Login</a></li> 
			        		</ul>  
			        	</div>
			        </div>
			    </div>


		    </div><!-- /.navbar-collapse -->
		  </div><!-- /.container-fluid -->
		</nav>

		<style type="text/css">
		.v-divider{
		 margin-left:5px;
		 margin-right:40px;
		 width:4px;
		 height:100%;
		 border-left:1px solid gray;
		}
		</style>

		<style type="text/css">
		.mymargin{
		 margin-left:110px;
		 margin-right:50px;
		}
		.table_name{
			font-size: 20px;
			padding-top: 23px;
		}
		.attri_name{
			font-size: 20px;
			margin-top: 23px;
			margin-left: 20px;
		}
		.table_name2{
			font-size: 20px;
		}
		</style>

		<div class="container">
			<div class="row">
				<div class="col-md-4">
					<div class="panel panel-default">
						  	<div class="panel-heading">
						    	<h3 class="panel-title">Tables and fields</h3>
						  	</div>
						  	<div class="btn-group-vertical center-block" role="group" aria-label="...">
						  	  <%ActiveRecord::Base.connection.tables.each do |tables| %>
						  	    <%if ! tables.match(/\Aschema_migrations\Z/)%>
						  	    	<div class="btn-group">
									  <button class="btn btn-default btn-lg dropdown-toggle table_name2" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false" value="<%=tables%>" onclick="attri(this)" onmouseover="jumpto(this)"><%=tables%></button>
									</div>

						  	  		<%tables.classify.constantize.column_names.each do |cname| %>
						  	  			<%if ! cname.match(/\Aid\Z/) && ! cname.match(/\Acreated_at\Z/) && ! cname.match(/\Aupdated_at\Z/)%>
						  	  			<button type="button" class="btn btn-default" value="<%=cname%>" onclick="attri(this)"><%=cname%></button>
						  	  			<%end%>
							  		<%end%>
						  	  	<%end%>
						  	  <%end%>
							  
							</div>
					</div>
				</div>
	
				<div class="col-md-8">
					<div class="btn-group btn-group-justified" role="group" aria-label="..." style="margin-bottom:30px;">
						<div class="btn-group" role="group">
					    	<button type="button" class="btn btn-default disabled">Operators</button>
					  	</div>
					    <div class="btn-group" role="group">
					    	<button type="button" class="btn btn-default bind_hover_card" value="π" onclick="input(this)" data-toggle="popover" title="Usage" data-placement="bottom" data-trigger="hover">π</button>
					  	</div>
					  	<div class="btn-group" role="group">
					    	<button type="button" class="btn btn-default bind_hover_card" value="ρ" onclick="input(this)" data-toggle="popover" title="Usage" data-placement="bottom" data-trigger="hover">ρ</button>
					  	</div>
					  	<div class="btn-group" role="group">
					    	<button type="button" class="btn btn-default bind_hover_card" value="x" onclick="input(this)" data-toggle="popover" title="Usage" data-placement="bottom" data-trigger="hover">x</button>
					  	</div>
					 	<div class="btn-group" role="group">
					    	<button type="button" class="btn btn-default bind_hover_card" value="σ" onclick="input(this)" data-toggle="popover" title="Usage" data-placement="bottom" data-trigger="hover">σ</button>
					  	</div>
					  	<div class="btn-group" role="group">
					    	<button type="button" class="btn btn-default bind_hover_card" value="⨝" onclick="input(this)" data-toggle="popover" title="Usage" data-placement="bottom" data-trigger="hover">⨝</button>
					  	</div>
					  	<div class="btn-group" role="group">
					    	<button type="button" class="btn btn-default bind_hover_card" value="∧" onclick="input(this)" data-toggle="popover" title="Usage" data-placement="bottom" data-trigger="hover">∧</button>
					  	</div>
					  	<div class="btn-group" role="group">
					    	<button type="button" class="btn btn-default bind_hover_card" value="∨" onclick="input(this)" data-toggle="popover" title="Usage" data-placement="bottom" data-trigger="hover">∨</button>
					  	</div>
					</div>

					
					<script>
						$(document).ready(function(){
						    $('[data-toggle="popover"]').popover({
							        html : true, 
							        container: 'body',
							        delay:{show:200, hide:400},
							        content: function() {
							          return content(this);  
							        } 
							    });   
						});

						function content(obj) {
							var value=obj.value;
							var data;
							if(value == "π")
								data = value + " colunm (TableName)";
							else if(value == "ρ")
								data = value + "(NewTable,Table) Or ρ(NewTable(Colunms),Table(Colunms))";
							else if(value == "σ")
								data =  value + " condition (TableName)";
							else if(value == "⨝")
								data = "(TableName) ⨝ (TableName) Or (TableName) ⨝ condition (TableName) ";
							else
								data = "(TableName) "+ value + " (TableName)";
							return data;
						}

					
			
				        </script>

					</script>

					<!--insert in the cursor-->
					<script>
						function input(obj){
						    var p = document.getElementById("inputPlace");
						    p.focus();
						    if (document.all){
						        var r = document.selection.createRange();
						        document.selection.empty();
						        r.text = obj.value+"()";
						        r.collapse();
						        r.select();
						    }else{
						    	if(obj.value=="x"){
						    		var newstart = p.selectionStart+obj.value.length;
							        p.value=p.value.substr(0,p.selectionStart)+"()"+obj.value+"()"+p.value.substring(p.selectionEnd);
							        p.selectionStart = newstart;
							        p.selectionEnd = newstart;
						    	}else{
						    		var newstart = p.selectionStart+obj.value.length+1;
							        p.value=p.value.substr(0,p.selectionStart)+obj.value+"()"+p.value.substring(p.selectionEnd);
							        p.selectionStart = newstart;
							        p.selectionEnd = newstart;
						    	}
						        
						    }
						}

						function attri(obj){
						    var p = document.getElementById("inputPlace");
						    p.focus();
						    if (document.all){
						        var r = document.selection.createRange();
						        document.selection.empty();
						        r.text = obj.value;
						        r.collapse();
						        r.select();
						    }else{
						    		var newstart = p.selectionStart+obj.value.length+1;
							        p.value=p.value.substr(0,p.selectionStart)+obj.value+p.value.substring(p.selectionEnd);
							        p.selectionStart = newstart;
							        p.selectionEnd = newstart;
						       
						    }
						}

						function jumpto(obj){
							//if(window.location.href != "http://localhost:3000/"+obj.value)
							//	window.location.href = "http://localhost:3000/"+obj.value;
							document.getElementById("yield").innerHTML='<iframe src="'+obj.value+'" style="width:100%"></iframe>';
						}

						



					</script>


					 <h3>Enter your query:</h3>
					 <textarea class="form-control" rows="7" id="inputPlace" placeholder="Queris in relational algebra" style="margin-top:15px;"></textarea>
					 <button type="submit" class="btn btn-default" id="execute">Execute</button>
					 <button type="submit" class="btn btn-default">Download</button>
					 <button type="submit" class="btn btn-default">Upload(.xml)</button>

					 <div class="panel panel-default" style="margin-top:50px;">
						  	<div class="panel-heading">
						    	<h3 class="panel-title">Results</h3>
						  	</div>
						  	<div id ="yield">
						  	</div>
						  	<h3 calss="text-center">welcome!</h3>
						  	
   						
					</div>



				</div>

			</div>
		</div>
	  



	</body>
</html>












